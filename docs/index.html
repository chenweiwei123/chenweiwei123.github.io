<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>分组导航页</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Font Awesome 图标库 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

  <style>
    body {
      margin: 0;
      padding: 40px 20px;
      font-family: "Helvetica Neue", sans-serif;
      background: center center no-repeat fixed;
      background-size: cover;
      position: relative;
      z-index: 0;
      transition: background-image 0.6s ease;
    }

    body::before {
      content: "";
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.7);
      backdrop-filter: blur(6px);
      z-index: -1;
      padding-bottom: 150px; /* 防止内容被固定定位元素遮挡 */
    }
    .wallpaper-toggle {
      position: fixed;
      bottom: 0;
      right: 10px; /* 距离右边适当调整 */
      z-index: 1000;
      background-color: #f9f9f9;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 12px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      width: auto;
      max-width: calc(100% - 20px);
      text-align: center;
    }

    .wallpaper-toggle summary {
      font-size: 16px;
      cursor: pointer;
    }

    /* 新增壁纸设置面板样式 */
    .wallpaper-controls {
      text-align: center;
      margin-bottom: 30px;
    }

    .wallpaper-option {
      display: inline-block;
      width: 60px;
      height: 40px;
      margin: 0 8px;
      border-radius: 6px;
      overflow: hidden;
      border: 2px solid transparent;
      cursor: pointer;
      transition: transform 0.3s ease;
    }

    .wallpaper-option:hover {
      transform: scale(1.1);
      border-color: #007bff;
    }

    .wallpaper-option.selected {
      border-color: #007bff;
    }

    .toggle-btn {
      display: inline-block;
      margin-left: 12px;
      font-size: 14px;
      cursor: pointer;
      color: #007bff;
    }

    h1 {
      text-align: center;
      font-size: 36px;
      color: #222;
      margin-bottom: 20px;
    }

    .search-box {
      text-align: center;
      margin-bottom: 30px;
    }

    .search-box input {
      padding: 10px 14px;
      font-size: 16px;
      width: 280px;
      border: 1px solid #ccc;
      border-radius: 8px;
      outline: none;
    }

    .group-card {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06);
      margin: 0 auto 30px auto;
      padding: 20px 24px;
      max-width: 900px;
    }

    .group-title {
      font-size: 22px;
      font-weight: 600;
      margin-bottom: 18px;
      color: #007BFF;
      border-bottom: 1px solid #eee;
      padding-bottom: 8px;
    }

    .nav-list {
      display: grid;
      grid-template-columns: repeat(3, 1fr); /* 默认三列 */
      gap: 16px;
    }
    @media (max-width: 960px) {
      .nav-list {
        grid-template-columns: repeat(2, 1fr); /* 小屏下两列 */
      }
    }

    @media (max-width: 600px) {
      .nav-list {
        grid-template-columns: 1fr; /* 手机端单列 */
      }
    }
    .nav-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: #f9f9f9;
      border-radius: 10px;
      padding: 10px 16px;
      text-decoration: none;
      color: #333;
      font-size: 16px;
      flex: 1 1 200px;
      transition: background 0.3s ease, transform 0.3s ease;
      position: relative;
    }

    .nav-left {
      display: flex;
      align-items: center;
    }

    .nav-icon {
      font-size: 20px;
      margin-right: 10px;
      transition: transform 0.3s ease;
    }

    .nav-item:hover .nav-icon {
      transform: scale(1.2) rotate(8deg);
    }

    .fav-icon {
      color: #ccc;
      cursor: pointer;
      font-size: 16px;
      transition: color 0.3s;
    }

    .fav-icon.active {
      color: gold;
    }

    .hidden {
      display: none !important;
    }
  </style>
</head>
<body>
<h1 style="text-align: -moz-left;">
    我的导航页 <i class="fas fa-rocket" style="color: #007bff;"></i>
</h1>
<details id="dailyWallpaperToggle" class="wallpaper-toggle">
  <summary>每日壁纸设置</summary>
  <div class="wallpaper-controls">
    <span>选择壁纸：</span>
    <div id="wallpaperOptions" style="display:inline-block;"></div>
    <span class="toggle-btn" id="toggleDaily">切换每日模式</span>
    <input type="file" id="uploadWallpaper" accept="image/*" style="display: none;" />
    <label for="uploadWallpaper" class="toggle-btn">上传自定义壁纸</label>
  </div>
</details>
<div class="search-box">
  <input type="text" id="searchInput" placeholder="搜索网站名称...">
</div>

<div id="navRoot"></div>

<script>
  // 模拟从 nav.json 读取的结构
  const navData = {
    "常用网站": [
      { name: "百度", url: "https://www.baidu.com", icon: "fa-solid fa-magnifying-glass" },
      { name: "Google", url: "https://www.google.com", icon: "fa-brands fa-google" },
      { name: "知乎", url: "https://www.zhihu.com", icon: "fa-solid fa-lightbulb" },
      { name: "掘金酱", url: "https://e.juejin.cn/#/", icon: "fa-solid fa-tv" },
      { name: "掘金酱123", url: "https://e.juejin.cn/#/", icon: "fa-solid fa-tv" }

    ],
    "基础工具": [
      { name: "GitHub", url: "https://github.com", icon: "fa-brands fa-github" },
      { name: "Stack Overflow", url: "https://stackoverflow.com", icon: "fa-brands fa-stack-overflow" },
      { name: "W3School", url: "https://www.w3school.com.cn", icon: "fa-solid fa-book" },
      { name: "马丁学编程", url: "https://nageoffer.com/", icon: "fa-solid fa-code" }
    ]
  };

  const navRoot = document.getElementById("navRoot");
  const searchInput = document.getElementById("searchInput");
  const allNavItems = [];

  // 从 localStorage 获取收藏夹
  const favoriteUrls = new Set(JSON.parse(localStorage.getItem("favorites") || "[]"));

  // 添加收藏夹分组
  function renderFavorites() {
    const favorites = [];
    for (const [group, items] of Object.entries(navData)) {
      for (const item of items) {
        if (favoriteUrls.has(item.url)) {
          favorites.push(item);
        }
      }
    }
    if (favorites.length > 0) {
      renderGroup("⭐ 收藏夹", favorites, true);
    }
  }

  // 渲染单个分组
  function renderGroup(title, links, isFavorites = false) {
    const groupCard = document.createElement("div");
    groupCard.className = "group-card";

    const titleEl = document.createElement("div");
    titleEl.className = "group-title";
    titleEl.textContent = title;

    const navList = document.createElement("div");
    navList.className = "nav-list";

    links.forEach(link => {
      const a = document.createElement("a");
      a.className = "nav-item";
      a.href = link.url;
      a.target = "_blank";

      const left = document.createElement("div");
      left.className = "nav-left";
      left.innerHTML = `
          <i class="nav-icon ${link.icon}"></i>
          <div class="nav-name">${link.name}</div>
        `;

      const fav = document.createElement("i");
      fav.className = "fa-star fav-icon fas";
      if (favoriteUrls.has(link.url)) {
        fav.classList.add("active");
      }

      fav.addEventListener("click", e => {
        e.preventDefault();
        e.stopPropagation();
        if (favoriteUrls.has(link.url)) {
          favoriteUrls.delete(link.url);
          fav.classList.remove("active");
        } else {
          favoriteUrls.add(link.url);
          fav.classList.add("active");
        }
        localStorage.setItem("favorites", JSON.stringify([...favoriteUrls]));
        // 重新渲染收藏夹
        renderAll();
      });

      a.appendChild(left);
      a.appendChild(fav);
      navList.appendChild(a);
      if (!isFavorites) {
        allNavItems.push({ element: a, name: link.name.toLowerCase() });
      }
    });

    groupCard.appendChild(titleEl);
    groupCard.appendChild(navList);
    navRoot.appendChild(groupCard);
  }

  // 渲染所有分组（含收藏夹）
  function renderAll() {
    navRoot.innerHTML = "";
    renderFavorites();
    for (const [group, links] of Object.entries(navData)) {
      renderGroup(group, links);
    }
  }

  renderAll();

  // 搜索过滤
  searchInput.addEventListener("input", function () {
    const keyword = this.value.trim().toLowerCase();
    allNavItems.forEach(({ element, name }) => {
      element.classList.toggle("hidden", !name.includes(keyword));
    });
  });

  // 壁纸功能
  const wallpapers = [
    "https://picsum.photos/1920/1080/?mountain",
    "https://picsum.photos/1920/1080/?city",
    "https://picsum.photos/1920/1080/?space",
    "https://picsum.photos/1920/1080/?coding",
    "https://picsum.photos/1920/1080/?landscape"
  ];

  const wallpaperKey = "custom_wallpaper";
  const dailyModeKey = "wallpaper_daily";

  const wallpaperContainer = document.getElementById("wallpaperOptions");
  const toggleBtn = document.getElementById("toggleDaily");

  function applyWallpaper() {
    const dailyMode = localStorage.getItem(dailyModeKey) !== "false";
    if (dailyMode) {
      document.body.style.backgroundImage = `url('https://source.unsplash.com/1920x1080/?nature')`;
      toggleBtn.textContent = "每日一图：开";
    } else {
      let custom = localStorage.getItem(wallpaperKey);
      if (!custom) {
        // 首次访问，随机选一张壁纸
        custom = wallpapers[Math.floor(Math.random() * wallpapers.length)];
        localStorage.setItem(wallpaperKey, custom);
      }
      document.body.style.backgroundImage = `url('${custom}')`;
      toggleBtn.textContent = "每日一图：关";
    }
  }

  function renderWallpaperOptions() {
    wallpaperContainer.innerHTML = "";
    wallpapers.forEach((url, idx) => {
      const div = document.createElement("div");
      div.className = "wallpaper-option";
      div.style.backgroundImage = `url('${url}')`;
      div.style.backgroundSize = "cover";
      div.title = `壁纸${idx + 1}`;

      if (localStorage.getItem(wallpaperKey) === url) {
        div.classList.add("selected");
      }

      div.onclick = () => {
        localStorage.setItem(wallpaperKey, url);
        localStorage.setItem(dailyModeKey, "false");
        applyWallpaper();
        renderWallpaperOptions();
      };

      wallpaperContainer.appendChild(div);
    });
  }

  toggleBtn.onclick = () => {
    const current = localStorage.getItem(dailyModeKey) !== "false";
    localStorage.setItem(dailyModeKey, String(!current));
    applyWallpaper();
  };

  renderWallpaperOptions();
  applyWallpaper();
  document.getElementById("dailyWallpaperToggle").addEventListener("toggle", function () {
    if (!this.open) {
      // 折叠时可执行的操作（如释放资源）
    } else {
      // 展开时可执行的操作（如刷新壁纸列表）
      renderWallpaperOptions();
    }
  });
</script>

</body>
</html>